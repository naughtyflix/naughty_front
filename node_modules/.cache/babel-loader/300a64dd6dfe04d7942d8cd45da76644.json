{"ast":null,"code":"import poolsConfig from 'config/constants/pools';\nimport masterChefABI from 'config/abi/masterchef.json';\nimport sousChefABI from 'config/abi/sousChef.json';\nimport erc20ABI from 'config/abi/erc20.json';\nimport { QuoteToken } from 'config/constants/types';\nimport multicall from 'utils/multicall';\nimport { getMasterChefAddress } from 'utils/addressHelpers';\nimport { getWeb3 } from 'utils/web3';\nimport BigNumber from 'bignumber.js';\nconst CHAIN_ID = process.env.REACT_APP_CHAIN_ID; // Pool 0, Cake / Cake is a different kind of contract (master chef)\n// BNB pools use the native BNB token (wrapping ? unwrapping is done at the contract level)\n\nconst nonBnbPools = poolsConfig.filter(p => p.stakingTokenName !== QuoteToken.BNB);\nconst bnbPools = poolsConfig.filter(p => p.stakingTokenName === QuoteToken.BNB);\nconst nonMasterPools = poolsConfig.filter(p => p.sousId !== 0);\nconst web3 = getWeb3();\nconst masterChefContract = new web3.eth.Contract(masterChefABI, getMasterChefAddress());\nexport const fetchPoolsAllowance = async account => {\n  const calls = nonBnbPools.map(p => ({\n    address: p.stakingTokenAddress,\n    name: 'allowance',\n    params: [account, p.contractAddress[CHAIN_ID]]\n  }));\n  const allowances = await multicall(erc20ABI, calls);\n  return nonBnbPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(allowances[index]).toJSON()\n  }), {});\n};\nexport const fetchUserBalances = async account => {\n  // Non BNB pools\n  const calls = nonBnbPools.map(p => ({\n    address: p.stakingTokenAddress,\n    name: 'balanceOf',\n    params: [account]\n  }));\n  const tokenBalancesRaw = await multicall(erc20ABI, calls);\n  const tokenBalances = nonBnbPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(tokenBalancesRaw[index]).toJSON()\n  }), {}); // BNB pools\n\n  const bnbBalance = await web3.eth.getBalance(account);\n  const bnbBalances = bnbPools.reduce((acc, pool) => ({ ...acc,\n    [pool.sousId]: new BigNumber(bnbBalance).toJSON()\n  }), {});\n  return { ...tokenBalances,\n    ...bnbBalances\n  };\n};\nexport const fetchUserStakeBalances = async account => {\n  const calls = nonMasterPools.map(p => ({\n    address: p.contractAddress[CHAIN_ID],\n    name: 'userInfo',\n    params: [account]\n  }));\n  const userInfo = await multicall(sousChefABI, calls);\n  const stakedBalances = nonMasterPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(userInfo[index].amount._hex).toJSON()\n  }), {}); // Cake / Cake pool\n\n  const {\n    amount: masterPoolAmount\n  } = await masterChefContract.methods.userInfo('0', account).call();\n  return { ...stakedBalances,\n    0: new BigNumber(masterPoolAmount).toJSON()\n  };\n};\nexport const fetchUserPendingRewards = async account => {\n  const calls = nonMasterPools.map(p => ({\n    address: p.contractAddress[CHAIN_ID],\n    name: 'pendingReward',\n    params: [account]\n  }));\n  const res = await multicall(sousChefABI, calls);\n  const pendingRewards = nonMasterPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(res[index]).toJSON()\n  }), {}); // Cake / Cake pool\n\n  const pendingReward = await masterChefContract.methods.pendingPASTA('0', account).call();\n  return { ...pendingRewards,\n    0: new BigNumber(pendingReward).toJSON()\n  };\n};","map":{"version":3,"sources":["/Users/ivopascoal/Desktop/Naughty/naughty_front/src/state/pools/fetchPoolsUser.ts"],"names":["poolsConfig","masterChefABI","sousChefABI","erc20ABI","QuoteToken","multicall","getMasterChefAddress","getWeb3","BigNumber","CHAIN_ID","process","env","REACT_APP_CHAIN_ID","nonBnbPools","filter","p","stakingTokenName","BNB","bnbPools","nonMasterPools","sousId","web3","masterChefContract","eth","Contract","fetchPoolsAllowance","account","calls","map","address","stakingTokenAddress","name","params","contractAddress","allowances","reduce","acc","pool","index","toJSON","fetchUserBalances","tokenBalancesRaw","tokenBalances","bnbBalance","getBalance","bnbBalances","fetchUserStakeBalances","userInfo","stakedBalances","amount","_hex","masterPoolAmount","methods","call","fetchUserPendingRewards","res","pendingRewards","pendingReward","pendingPASTA"],"mappings":"AACA,OAAOA,WAAP,MAAwB,wBAAxB;AACA,OAAOC,aAAP,MAA0B,4BAA1B;AACA,OAAOC,WAAP,MAAwB,0BAAxB;AACA,OAAOC,QAAP,MAAqB,uBAArB;AACA,SAASC,UAAT,QAA2B,wBAA3B;AACA,OAAOC,SAAP,MAAsB,iBAAtB;AACA,SAASC,oBAAT,QAAqC,sBAArC;AACA,SAASC,OAAT,QAAwB,YAAxB;AACA,OAAOC,SAAP,MAAsB,cAAtB;AAEA,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAR,CAAYC,kBAA7B,C,CAEA;AACA;;AACA,MAAMC,WAAW,GAAGb,WAAW,CAACc,MAAZ,CAAoBC,CAAD,IAAOA,CAAC,CAACC,gBAAF,KAAuBZ,UAAU,CAACa,GAA5D,CAApB;AACA,MAAMC,QAAQ,GAAGlB,WAAW,CAACc,MAAZ,CAAoBC,CAAD,IAAOA,CAAC,CAACC,gBAAF,KAAuBZ,UAAU,CAACa,GAA5D,CAAjB;AACA,MAAME,cAAc,GAAGnB,WAAW,CAACc,MAAZ,CAAoBC,CAAD,IAAOA,CAAC,CAACK,MAAF,KAAa,CAAvC,CAAvB;AACA,MAAMC,IAAI,GAAGd,OAAO,EAApB;AACA,MAAMe,kBAAkB,GAAG,IAAID,IAAI,CAACE,GAAL,CAASC,QAAb,CAAuBvB,aAAvB,EAA6DK,oBAAoB,EAAjF,CAA3B;AAEA,OAAO,MAAMmB,mBAAmB,GAAG,MAAOC,OAAP,IAAmB;AACpD,QAAMC,KAAK,GAAGd,WAAW,CAACe,GAAZ,CAAiBb,CAAD,KAAQ;AACpCc,IAAAA,OAAO,EAAEd,CAAC,CAACe,mBADyB;AAEpCC,IAAAA,IAAI,EAAE,WAF8B;AAGpCC,IAAAA,MAAM,EAAE,CAACN,OAAD,EAAUX,CAAC,CAACkB,eAAF,CAAkBxB,QAAlB,CAAV;AAH4B,GAAR,CAAhB,CAAd;AAMA,QAAMyB,UAAU,GAAG,MAAM7B,SAAS,CAACF,QAAD,EAAWwB,KAAX,CAAlC;AACA,SAAOd,WAAW,CAACsB,MAAZ,CACL,CAACC,GAAD,EAAMC,IAAN,EAAYC,KAAZ,MAAuB,EAAE,GAAGF,GAAL;AAAU,KAACC,IAAI,CAACjB,MAAN,GAAe,IAAIZ,SAAJ,CAAc0B,UAAU,CAACI,KAAD,CAAxB,EAAiCC,MAAjC;AAAzB,GAAvB,CADK,EAEL,EAFK,CAAP;AAID,CAZM;AAcP,OAAO,MAAMC,iBAAiB,GAAG,MAAOd,OAAP,IAAmB;AAClD;AACA,QAAMC,KAAK,GAAGd,WAAW,CAACe,GAAZ,CAAiBb,CAAD,KAAQ;AACpCc,IAAAA,OAAO,EAAEd,CAAC,CAACe,mBADyB;AAEpCC,IAAAA,IAAI,EAAE,WAF8B;AAGpCC,IAAAA,MAAM,EAAE,CAACN,OAAD;AAH4B,GAAR,CAAhB,CAAd;AAKA,QAAMe,gBAAgB,GAAG,MAAMpC,SAAS,CAACF,QAAD,EAAWwB,KAAX,CAAxC;AACA,QAAMe,aAAa,GAAG7B,WAAW,CAACsB,MAAZ,CACpB,CAACC,GAAD,EAAMC,IAAN,EAAYC,KAAZ,MAAuB,EAAE,GAAGF,GAAL;AAAU,KAACC,IAAI,CAACjB,MAAN,GAAe,IAAIZ,SAAJ,CAAciC,gBAAgB,CAACH,KAAD,CAA9B,EAAuCC,MAAvC;AAAzB,GAAvB,CADoB,EAEpB,EAFoB,CAAtB,CARkD,CAalD;;AACA,QAAMI,UAAU,GAAG,MAAMtB,IAAI,CAACE,GAAL,CAASqB,UAAT,CAAoBlB,OAApB,CAAzB;AACA,QAAMmB,WAAW,GAAG3B,QAAQ,CAACiB,MAAT,CAClB,CAACC,GAAD,EAAMC,IAAN,MAAgB,EAAE,GAAGD,GAAL;AAAU,KAACC,IAAI,CAACjB,MAAN,GAAe,IAAIZ,SAAJ,CAAcmC,UAAd,EAA0BJ,MAA1B;AAAzB,GAAhB,CADkB,EAElB,EAFkB,CAApB;AAKA,SAAO,EAAE,GAAGG,aAAL;AAAoB,OAAGG;AAAvB,GAAP;AACD,CArBM;AAuBP,OAAO,MAAMC,sBAAsB,GAAG,MAAOpB,OAAP,IAAmB;AACvD,QAAMC,KAAK,GAAGR,cAAc,CAACS,GAAf,CAAoBb,CAAD,KAAQ;AACvCc,IAAAA,OAAO,EAAEd,CAAC,CAACkB,eAAF,CAAkBxB,QAAlB,CAD8B;AAEvCsB,IAAAA,IAAI,EAAE,UAFiC;AAGvCC,IAAAA,MAAM,EAAE,CAACN,OAAD;AAH+B,GAAR,CAAnB,CAAd;AAKA,QAAMqB,QAAQ,GAAG,MAAM1C,SAAS,CAACH,WAAD,EAAcyB,KAAd,CAAhC;AACA,QAAMqB,cAAc,GAAG7B,cAAc,CAACgB,MAAf,CACrB,CAACC,GAAD,EAAMC,IAAN,EAAYC,KAAZ,MAAuB,EACrB,GAAGF,GADkB;AAErB,KAACC,IAAI,CAACjB,MAAN,GAAe,IAAIZ,SAAJ,CAAcuC,QAAQ,CAACT,KAAD,CAAR,CAAgBW,MAAhB,CAAuBC,IAArC,EAA2CX,MAA3C;AAFM,GAAvB,CADqB,EAKrB,EALqB,CAAvB,CAPuD,CAevD;;AACA,QAAM;AAAEU,IAAAA,MAAM,EAAEE;AAAV,MAA+B,MAAM7B,kBAAkB,CAAC8B,OAAnB,CAA2BL,QAA3B,CAAoC,GAApC,EAAyCrB,OAAzC,EAAkD2B,IAAlD,EAA3C;AAEA,SAAO,EAAE,GAAGL,cAAL;AAAqB,OAAG,IAAIxC,SAAJ,CAAc2C,gBAAd,EAAgCZ,MAAhC;AAAxB,GAAP;AACD,CAnBM;AAqBP,OAAO,MAAMe,uBAAuB,GAAG,MAAO5B,OAAP,IAAmB;AACxD,QAAMC,KAAK,GAAGR,cAAc,CAACS,GAAf,CAAoBb,CAAD,KAAQ;AACvCc,IAAAA,OAAO,EAAEd,CAAC,CAACkB,eAAF,CAAkBxB,QAAlB,CAD8B;AAEvCsB,IAAAA,IAAI,EAAE,eAFiC;AAGvCC,IAAAA,MAAM,EAAE,CAACN,OAAD;AAH+B,GAAR,CAAnB,CAAd;AAKA,QAAM6B,GAAG,GAAG,MAAMlD,SAAS,CAACH,WAAD,EAAcyB,KAAd,CAA3B;AACA,QAAM6B,cAAc,GAAGrC,cAAc,CAACgB,MAAf,CACrB,CAACC,GAAD,EAAMC,IAAN,EAAYC,KAAZ,MAAuB,EACrB,GAAGF,GADkB;AAErB,KAACC,IAAI,CAACjB,MAAN,GAAe,IAAIZ,SAAJ,CAAc+C,GAAG,CAACjB,KAAD,CAAjB,EAA0BC,MAA1B;AAFM,GAAvB,CADqB,EAKrB,EALqB,CAAvB,CAPwD,CAexD;;AACA,QAAMkB,aAAa,GAAG,MAAMnC,kBAAkB,CAAC8B,OAAnB,CAA2BM,YAA3B,CAAwC,GAAxC,EAA6ChC,OAA7C,EAAsD2B,IAAtD,EAA5B;AAEA,SAAO,EAAE,GAAGG,cAAL;AAAqB,OAAG,IAAIhD,SAAJ,CAAciD,aAAd,EAA6BlB,MAA7B;AAAxB,GAAP;AACD,CAnBM","sourcesContent":["import { AbiItem } from 'web3-utils'\r\nimport poolsConfig from 'config/constants/pools'\r\nimport masterChefABI from 'config/abi/masterchef.json'\r\nimport sousChefABI from 'config/abi/sousChef.json'\r\nimport erc20ABI from 'config/abi/erc20.json'\r\nimport { QuoteToken } from 'config/constants/types'\r\nimport multicall from 'utils/multicall'\r\nimport { getMasterChefAddress } from 'utils/addressHelpers'\r\nimport { getWeb3 } from 'utils/web3'\r\nimport BigNumber from 'bignumber.js'\r\n\r\nconst CHAIN_ID = process.env.REACT_APP_CHAIN_ID\r\n\r\n// Pool 0, Cake / Cake is a different kind of contract (master chef)\r\n// BNB pools use the native BNB token (wrapping ? unwrapping is done at the contract level)\r\nconst nonBnbPools = poolsConfig.filter((p) => p.stakingTokenName !== QuoteToken.BNB)\r\nconst bnbPools = poolsConfig.filter((p) => p.stakingTokenName === QuoteToken.BNB)\r\nconst nonMasterPools = poolsConfig.filter((p) => p.sousId !== 0)\r\nconst web3 = getWeb3()\r\nconst masterChefContract = new web3.eth.Contract((masterChefABI as unknown) as AbiItem, getMasterChefAddress())\r\n\r\nexport const fetchPoolsAllowance = async (account) => {\r\n  const calls = nonBnbPools.map((p) => ({\r\n    address: p.stakingTokenAddress,\r\n    name: 'allowance',\r\n    params: [account, p.contractAddress[CHAIN_ID]],\r\n  }))\r\n\r\n  const allowances = await multicall(erc20ABI, calls)\r\n  return nonBnbPools.reduce(\r\n    (acc, pool, index) => ({ ...acc, [pool.sousId]: new BigNumber(allowances[index]).toJSON() }),\r\n    {},\r\n  )\r\n}\r\n\r\nexport const fetchUserBalances = async (account) => {\r\n  // Non BNB pools\r\n  const calls = nonBnbPools.map((p) => ({\r\n    address: p.stakingTokenAddress,\r\n    name: 'balanceOf',\r\n    params: [account],\r\n  }))\r\n  const tokenBalancesRaw = await multicall(erc20ABI, calls)\r\n  const tokenBalances = nonBnbPools.reduce(\r\n    (acc, pool, index) => ({ ...acc, [pool.sousId]: new BigNumber(tokenBalancesRaw[index]).toJSON() }),\r\n    {},\r\n  )\r\n\r\n  // BNB pools\r\n  const bnbBalance = await web3.eth.getBalance(account)\r\n  const bnbBalances = bnbPools.reduce(\r\n    (acc, pool) => ({ ...acc, [pool.sousId]: new BigNumber(bnbBalance).toJSON() }),\r\n    {},\r\n  )\r\n\r\n  return { ...tokenBalances, ...bnbBalances }\r\n}\r\n\r\nexport const fetchUserStakeBalances = async (account) => {\r\n  const calls = nonMasterPools.map((p) => ({\r\n    address: p.contractAddress[CHAIN_ID],\r\n    name: 'userInfo',\r\n    params: [account],\r\n  }))\r\n  const userInfo = await multicall(sousChefABI, calls)\r\n  const stakedBalances = nonMasterPools.reduce(\r\n    (acc, pool, index) => ({\r\n      ...acc,\r\n      [pool.sousId]: new BigNumber(userInfo[index].amount._hex).toJSON(),\r\n    }),\r\n    {},\r\n  )\r\n\r\n  // Cake / Cake pool\r\n  const { amount: masterPoolAmount } = await masterChefContract.methods.userInfo('0', account).call()\r\n\r\n  return { ...stakedBalances, 0: new BigNumber(masterPoolAmount).toJSON() }\r\n}\r\n\r\nexport const fetchUserPendingRewards = async (account) => {\r\n  const calls = nonMasterPools.map((p) => ({\r\n    address: p.contractAddress[CHAIN_ID],\r\n    name: 'pendingReward',\r\n    params: [account],\r\n  }))\r\n  const res = await multicall(sousChefABI, calls)\r\n  const pendingRewards = nonMasterPools.reduce(\r\n    (acc, pool, index) => ({\r\n      ...acc,\r\n      [pool.sousId]: new BigNumber(res[index]).toJSON(),\r\n    }),\r\n    {},\r\n  )\r\n\r\n  // Cake / Cake pool\r\n  const pendingReward = await masterChefContract.methods.pendingPASTA('0', account).call()\r\n\r\n  return { ...pendingRewards, 0: new BigNumber(pendingReward).toJSON() }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}